{% extends "layout/basic.html" %}

{% block content %}
<div class="row">
  <div class="medium-12 columns">
    <div class="section">
      <div class="section__header">
        <h1 class="section__title">{{ _('Typing Game') }}</h1>
        <div class="section__tools">
          <a href="{{ url('typing_practice', mode='basic') }}" class="button rounded primary">
            <i class="icon icon-keyboard"></i> {{ _('Start Practice') }}
          </a>
          <a href="{{ url('typing_contest') }}" class="button rounded">
            <i class="icon icon-trophy"></i> {{ _('Join Contest') }}
          </a>
          <a href="{{ url('typing_ranking') }}" class="button rounded">
            <i class="icon icon-ranking"></i> {{ _('View Rankings') }}
          </a>
        </div>
      </div>
      
      <div class="section__body">
        <!-- 用户统计 -->
        <div class="typing-stats">
          <h3>{{ _('Your Statistics') }}</h3>
          {% if stats %}
          <div class="row">
            <div class="medium-3 columns">
              <div class="stat-card">
                <div class="stat-value">{{ stats.totalScore }}</div>
                <div class="stat-label">{{ _('Total Score') }}</div>
              </div>
            </div>
            <div class="medium-3 columns">
              <div class="stat-card">
                <div class="stat-value">{{ stats.bestWpm }} WPM</div>
                <div class="stat-label">{{ _('Best Speed') }}</div>
              </div>
            </div>
            <div class="medium-3 columns">
              <div class="stat-card">
                <div class="stat-value">{{ stats.avgAccuracy|round(1) }}%</div>
                <div class="stat-label">{{ _('Average Accuracy') }}</div>
              </div>
            </div>
            <div class="medium-3 columns">
              <div class="stat-card">
                <div class="stat-value">{{ stats.practiceCount + stats.contestCount }}</div>
                <div class="stat-label">{{ _('Total Games') }}</div>
              </div>
            </div>
          </div>
          {% else %}
          <p>{{ _('No statistics yet. Start practicing!') }}</p>
          {% endif %}
        </div>
        
        <!-- 练习模式 -->
        <div class="practice-modes">
          <h3>{{ _('Practice Modes') }}</h3>
          <div class="row">
            <div class="medium-3 columns">
              <a href="{{ url('typing_practice', mode='basic') }}" class="mode-card">
                <i class="icon icon-keyboard-o"></i>
                <h4>{{ _('Basic Keys') }}</h4>
                <p>{{ _('Practice home row keys') }}</p>
              </a>
            </div>
            <div class="medium-3 columns">
              <a href="{{ url('typing_practice', mode='letters') }}" class="mode-card">
                <i class="icon icon-font"></i>
                <h4>{{ _('Letters') }}</h4>
                <p>{{ _('Practice alphabet and sentences') }}</p>
              </a>
            </div>
            <div class="medium-3 columns">
              <a href="{{ url('typing_practice', mode='words') }}" class="mode-card">
                <i class="icon icon-book"></i>
                <h4>{{ _('Words') }}</h4>
                <p>{{ _('Practice common words') }}</p>
              </a>
            </div>
            <div class="medium-3 columns">
              <a href="{{ url('typing_practice', mode='code') }}" class="mode-card">
                <i class="icon icon-code"></i>
                <h4>{{ _('Code') }}</h4>
                <p>{{ _('Practice coding syntax') }}</p>
              </a>
            </div>
          </div>
        </div>
        
        <!-- 最近记录 -->
        {% if recentRecords.length %}
        <div class="recent-records">
          <h3>{{ _('Recent Records') }}</h3>
          <table class="data-table">
            <thead>
              <tr>
                <th>{{ _('Date') }}</th>
                <th>{{ _('Mode') }}</th>
                <th>{{ _('WPM') }}</th>
                <th>{{ _('Accuracy') }}</th>
                <th>{{ _('Score') }}</th>
              </tr>
            </thead>
            <tbody>
              {% for record in recentRecords %}
              <tr>
                <td>{{ datetimeSpan(record.createdAt) }}</td>
                <td>{{ _(record.mode) }}</td>
                <td>{{ record.wpm }}</td>
                <td>{{ record.accuracy|round(1) }}%</td>
                <td>{{ record.score }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        {% endif %}
        
        <!-- 排行榜预览 -->
        {% if topPlayers.length %}
        <div class="top-players">
          <h3>{{ _('Top Players') }}</h3>
          <table class="data-table">
            <thead>
              <tr>
                <th>{{ _('Rank') }}</th>
                <th>{{ _('Player') }}</th>
                <th>{{ _('Total Score') }}</th>
                <th>{{ _('Best WPM') }}</th>
              </tr>
            </thead>
            <tbody>
              {% for player in topPlayers %}
              <tr>
                <td>{{ loop.index }}</td>
                <td>{{ user.render_inline(player.uid) }}</td>
                <td>{{ player.totalScore }}</td>
                <td>{{ player.bestWpm }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
          <p><a href="{{ url('typing_ranking') }}">{{ _('View Full Rankings') }} →</a></p>
        </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<style>
.typing-stats {
  margin-bottom: 30px;
}

.stat-card {
  background: #f5f5f5;
  padding: 20px;
  text-align: center;
  border-radius: 8px;
  margin-bottom: 20px;
}

.stat-value {
  font-size: 2em;
  font-weight: bold;
  color: #1779ba;
}

.stat-label {
  font-size: 0.9em;
  color: #666;
  margin-top: 5px;
}

.practice-modes {
  margin-bottom: 30px;
}

.mode-card {
  display: block;
  background: #f5f5f5;
  padding: 20px;
  text-align: center;
  border-radius: 8px;
  margin-bottom: 20px;
  text-decoration: none;
  color: inherit;
  transition: all 0.3s;
}

.mode-card:hover {
  background: #e8e8e8;
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

.mode-card i {
  font-size: 3em;
  color: #1779ba;
  margin-bottom: 10px;
}

.mode-card h4 {
  margin: 10px 0 5px 0;
}

.mode-card p {
  font-size: 0.9em;
  color: #666;
  margin: 0;
}

.recent-records, .top-players {
  margin-top: 30px;
}
</style>
{% endblock %}